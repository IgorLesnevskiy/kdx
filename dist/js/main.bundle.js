webpackJsonp([0],{11:function(t,exports,e){"use strict";(function($,t){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),i=e(4),o=e(2),n=function(){function t(){a(this,t),this.cCarambaController=new i,this.cTools=new o}return r(t,[{key:"init",value:function(){var t=this;return Promise.resolve().then(function(){t.initSmartLabels(),t.initCustomSelects(),t.cCarambaController.init()})}},{key:"initSmartLabels",value:function(){var t=$(".js-smart-label--input");t.length&&t.on("blur",function(){var t=$(this);t.toggleClass("is-fill",""!==t.val())}).blur()}},{key:"initCustomSelects",value:function(){var t=$("[data-is-custom-select]");t.length&&t.select2({})}}]),t}(),l=new n;$(document).ready(function(){l.init().then(function(){t.AC=l})})}).call(exports,e(1),e(0))},2:function(t,exports,e){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),i=function(){function t(){a(this,t)}return r(t,null,[{key:"cloneObject",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return JSON.parse(JSON.stringify(t))}},{key:"formatMoney",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ru",a=Number(t);return isNaN(a)?t:a.toLocaleString(e)}},{key:"getPriceWithTax",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:13,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Number(t),i=Number(e);if(isNaN(r)||isNaN(i))return t;var o=r*i/100+r;return o%1==0?o:o.toFixed(a)}}]),t}();t.exports=i},4:function(t,exports,e){"use strict";(function($){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),i=e(2),o=function(){function t(){a(this,t),this.loadUrl="https://rawgit.com/Varinetz/e6cbadec972e76a340c41a65fcc2a6b3/raw/90191826a3bac2ff0761040ed1d95c59f14eaf26/frontend_test_table.json",this.text={ru:{"status--pending":"Ожидается","status--out_of_stock":"Нет в наличии","status--in_stock":"В наличии","error--load_error":"Ошибка загрузки данных","error--empty_data":"Нет данных для отображения",remove_button_text:"Удалить",currency:"руб."},en:{}},this.locale="ru",this.tax=13,this.getText=this.getTextByLocale(this.locale),this.markupTemplate={scaffold:'\n\t\t\t\t<div class="b-custom-table__row" data-row-id="{{id}}">\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--title">\n\t\t\t\t    <div class="title">{{title}}</div>\n\t\t\t\t    {{optionalDescription}}\n\t\t\t\t  </div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--year">{{year}}</div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--color">\n\t\t\t\t    {{optionalColorbox}}\n\t\t\t\t  </div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--status">{{status}}</div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--price">\n\t\t\t\t    <nobr class="price js-price" data-original-price="{{price}}">{{formattedPrice}}</nobr>\n\t\t\t\t    <nobr class="price-with-tax js-price-with-tax" data-original-price-with-tax="{{priceWithTax}}">{{formattedPriceWithTax}} (+13%)</nobr>\n\t\t\t\t  </div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--action">\n\t\t\t\t    <button class="i-button i-button--ellipse i-button--size-small js-delete-trigger">{{removeButtonText}}</button>\n\t\t\t\t  </div>\n\t\t\t\t</div>\n\t\t\t',optional:{description:'<div class="description">{{description}}</div>',colorBox:'<div class="i-color-box" style="background-color: {{colorCode}}"></div>'}},this.$tableWrapper=null}return r(t,[{key:"init",value:function(){var t=this;this.$tableWrapper=$("#caramba-table"),this.$form=$("#caramba-form"),this.$tableWrapper.length&&this.$form.length&&(this.$tableRowContainer=this.$tableWrapper.find(".js-body"),this.$tableNoty=this.$tableWrapper.find(".js-noty"),this.$tableSummaryPrice=this.$tableWrapper.find(".js-summary-price"),this.initDeleteTrigger(),this.initForm(),this.lockTable(),this.loadData().then(function(e){return Promise.resolve().delay(1e3).then(function(){Object.keys(e).length?t.updateTableWithData(e):t.showTableNotification(t.getText("error--empty_data"))})}).then(function(){t.unlockTable()}).catch(function(e){t.showTableNotification(t.getText("error--load_error"))}))}},{key:"initForm",value:function(){var t=this;this.$form.parsley().on("form:submit",function(e){var a={};t.lockTable();for(var r in e.fields)if(e.fields.hasOwnProperty(r)){var i=e.fields[r].$element.attr("data-field-type");a[i]=e.fields[r].getValue()}a.id=t.generateUniqRowID();var o=[];o.push(a),t.addRowToLocalStorage(a),t.updateTableWithData(o,!0),e.$element[0].reset(),$(e.$element).parsley().reset();for(var n in e.fields)e.fields.hasOwnProperty(n)&&e.fields[n].$element.removeClass("is-fill");return t.unlockTable(),!1})}},{key:"generateUniqRowID",value:function(){var t=0,e=[];if($.each(this.getRows(),function(t,a){e.push($(a).attr("data-row-id"))}),e.length){t=Math.max.apply(null,e.map(Number))+1}return t}},{key:"loadData",value:function(){var t=this;return new Promise(function(e,a){$.ajax({url:t.loadUrl,data:{},dataType:"json",success:function(t){e(t)},error:function(t,e,r){a("false")}})}).then(function(e){var a=t.getAllRowsFromLocalStorage();return a?Object.assign({},a,e):e})}},{key:"lockTable",value:function(){}},{key:"updateTableWithData",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],[]);for(var a in t)if(t.hasOwnProperty(a)&&void 0!==t[a].id&&void 0!==t[a].title){var r=this.markupTemplate.scaffold;for(var o in t[a])if(t[a].hasOwnProperty(o)){var n=t[a][o];if("id"==o&&(r=r.replace(/{{id}}/g,n)),"title"==o&&(r=r.replace(/{{title}}/g,n)),"description"==o&&(r=r.replace(/{{optionalDescription}}/g,this.markupTemplate.optional.description),r=r.replace(/{{description}}/g,n)),"color"==o&&(r=r.replace(/{{optionalColorbox}}/g,this.markupTemplate.optional.colorBox),r=r.replace(/{{colorCode}}/g,n)),"year"==o&&(r=r.replace(/{{year}}/g,n)),"status"==o){"pednding"==n&&(n="pending");var l=this.getText("status--"+n);r=r.replace(/{{status}}/g,l||"-")}if("price"==o){var c=n,s=i.getPriceWithTax(n,this.tax),u=i.formatMoney(n,this.locale),f=i.formatMoney(i.getPriceWithTax(n,this.tax),this.locale);r=r.replace(/{{price}}/g,c),r=r.replace(/{{formattedPrice}}/g,u+" "+this.getText("currency")),r=r.replace(/{{priceWithTax}}/g,s),r=r.replace(/{{formattedPriceWithTax}}/g,f+" "+this.getText("currency"))}}r=r.replace(/{{optionalDescription}}/g,"").replace(/{{optionalColorbox}}/g,"").replace(/{{removeButtonText}}/g,this.getText("remove_button_text")),e.push(r)}this.$tableRowContainer.append(e.join("")),this.updateSummaryPrice(),this.updateTableViewStatus()}},{key:"updateSummaryPrice",value:function(){var t=0;$.each(this.getRows(),function(e,a){var r=$(a),i=r.find(".js-price-with-tax").length?r.find(".js-price-with-tax").attr("data-original-price-with-tax"):r.find(".js-price").attr("data-original-price");i&&(t=Number(t)+Number(i))}),this.$tableSummaryPrice.html(i.formatMoney(Number(t),this.locale)+" "+this.getText("currency"))}},{key:"getRows",value:function(){return this.$tableRowContainer.find("[data-row-id]")}},{key:"addRowToLocalStorage",value:function(t){t&&localStorage&&localStorage.setItem("autoParts--row-"+t.id,JSON.stringify(t))}},{key:"getAllRowsFromLocalStorage",value:function(){var t={};for(var e in localStorage)if(localStorage.hasOwnProperty(e)&&-1!=e.indexOf("autoParts--row")){var a=JSON.parse(localStorage.getItem(e));t[a.id]=a}return!!Object.keys(t).length&&t}},{key:"deleteRowFromLocalStorage",value:function(t){localStorage.getItem("autoParts--row-"+t)&&localStorage.removeItem("autoParts--row-"+t)}},{key:"getTextByLocale",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ru";arguments[1];return function(a){return!!(t.text&&t.text[e]&&t.text[e][a])&&t.text[e][a]}}},{key:"lockTable",value:function(){this.$tableWrapper.addClass("is-preloading")}},{key:"unlockTable",value:function(){this.$tableWrapper.removeClass("is-preloading")}},{key:"isTableLock",value:function(){}},{key:"showTableNotification",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t&&(this.$tableNoty.html(t),this.$tableWrapper.addClass("is-noty"))}},{key:"isNoRows",value:function(){return 0==this.getRows().length}},{key:"updateTableViewStatus",value:function(){this.isNoRows()?this.showTableNotification(this.getText("error--empty_data")):this.$tableWrapper.removeClass("is-noty")}},{key:"initDeleteTrigger",value:function(){var t=this;this.$tableWrapper.on("click",".js-delete-trigger",function(e){var a=$(e.currentTarget),r=a.closest("[data-row-id]");if(r.length){var i=r.attr("data-row-id");t.lockTable(),Promise.resolve().delay(100).then(function(){r.remove(),t.deleteRowFromLocalStorage(i),t.updateTableViewStatus(),t.updateSummaryPrice(),t.unlockTable()})}})}}]),t}();t.exports=o}).call(exports,e(1))}},[11]);