webpackJsonp([0],{13:function(t,exports,e){"use strict";(function($,t){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),i=e(4),o=e(2);Promise.config({warnings:!1,longStackTraces:!1,cancellation:!1,monitoring:!1});var n=function(){function t(){a(this,t),this.cCarambaController=new i,this.cTools=new o}return r(t,[{key:"init",value:function(){var t=this;return Promise.resolve().then(function(){t.initSmartLabels(),t.initCustomSelects(),t.initMasks(),t.initCustomFormValidators(),t.cCarambaController.init()})}},{key:"initSmartLabels",value:function(){var t=$(".js-smart-label--input");t.length&&t.on("blur",function(){var t=$(this);t.toggleClass("is-fill",""!==t.val())}).blur()}},{key:"initCustomSelects",value:function(){var t=$("[data-is-custom-select]");t.length&&t.select2({})}},{key:"initCustomFormValidators",value:function(){window.Parsley.addValidator("productionYear",{validateString:function(t){return Number(t)>=1980&&Number(t)<=(new Date).getFullYear()},messages:{ru:"Год может быть задан от 1980 до "+(new Date).getFullYear()}})}},{key:"initMasks",value:function(){var t=$("[data-year-mask]"),e=$("[data-money-mask]");t.length&&t.mask("9999"),e.length&&e.maskMoney({thousands:" ",decimal:".",allowNoDecimal:!0})}}]),t}(),l=new n;$(document).ready(function(){l.init().then(function(){t.AC=l})})}).call(exports,e(1),e(0))},2:function(t,exports,e){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),i=function(){function t(){a(this,t)}return r(t,null,[{key:"cloneObject",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return JSON.parse(JSON.stringify(t))}},{key:"formatMoney",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ru",a=Number(t);return isNaN(a)?t:a.toLocaleString(e)}},{key:"getPriceWithTax",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:13,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Number(t),i=Number(e);if(isNaN(r)||isNaN(i))return t;var o=r*i/100+r;return o%1==0?o:o.toFixed(a)}}]),t}();t.exports=i},4:function(t,exports,e){"use strict";(function($){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),i=e(2),o=function(){function t(){a(this,t),this.loadUrl="https://rawgit.com/Varinetz/e6cbadec972e76a340c41a65fcc2a6b3/raw/90191826a3bac2ff0761040ed1d95c59f14eaf26/frontend_test_table.json",this.text={ru:{"status--pending":"Ожидается","status--out_of_stock":"Нет в наличии","status--in_stock":"В наличии","error--load_error":"Ошибка загрузки данных","error--empty_data":"Нет данных для отображения",remove_button_text:"Удалить",currency:"руб."},en:{}},this.locale="ru",this.tax=13,this.getText=this.getTextByLocale(this.locale),this.markupTemplate={scaffold:'\n\t\t\t\t<div class="b-custom-table__row" data-row-id="{{id}}">\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--title">\n\t\t\t\t    <div class="title">{{title}}</div>\n\t\t\t\t    {{optionalDescription}}\n\t\t\t\t  </div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--year">{{year}}</div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--color">\n\t\t\t\t    {{optionalColorbox}}\n\t\t\t\t  </div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--status">{{status}}</div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--price">\n\t\t\t\t    <nobr class="price js-price" data-original-price="{{price}}">{{formattedPrice}}</nobr>\n\t\t\t\t    <nobr class="price-with-tax js-price-with-tax" data-original-price-with-tax="{{priceWithTax}}">{{formattedPriceWithTax}}</nobr>\n\t\t\t\t  </div>\n\t\t\t\t  <div class="b-custom-table__cell b-custom-table__cell--action">\n\t\t\t\t    <button class="i-button i-button--ellipse i-button--size-small js-delete-trigger">{{removeButtonText}}</button>\n\t\t\t\t  </div>\n\t\t\t\t</div>\n\t\t\t',optional:{description:'<div class="description">{{description}}</div>',colorBox:'<div class="i-color-box" style="background-color: {{colorCode}}"></div>'}},this.$tableWrapper=null}return r(t,[{key:"init",value:function(){var t=this;this.$tableWrapper=$("#caramba-table"),this.$form=$("#caramba-form"),this.$tableWrapper.length&&this.$form.length&&(this.$tableRowContainer=this.$tableWrapper.find(".js-body"),this.$tableNoty=this.$tableWrapper.find(".js-noty"),this.$tableSummaryPrice=this.$tableWrapper.find(".js-summary-price"),this.initDeleteTrigger(),this.initForm(),this.lockTable(),this.loadData().then(function(e){return Promise.resolve().delay(1e3).then(function(){Object.keys(e).length?t.updateTableWithData(e):t.showTableNotification(t.getText("error--empty_data"))})}).then(function(){t.unlockTable()}).catch(function(e){t.showTableNotification(t.getText("error--load_error"))}))}},{key:"initForm",value:function(){var t=this;this.$form.parsley().on("form:submit",function(e){var a={};if(t.isTableLock())return!1;t.lockTable();for(var r in e.fields)if(e.fields.hasOwnProperty(r)){var i=e.fields[r].$element.attr("data-field-type"),o=e.fields[r].getValue();a[i]="price"==i?o.replace(/\s/,"").replace(/,/,"."):o}a.id=t.generateUniqRowID();var n=[];return n.push(a),t.addRowToLocalStorage(a),t.updateTableWithData(n,!0),t.resetForm(e),t.unlockTable(),!1})}},{key:"resetForm",value:function(t){var e=$(t.$element),a=e.find("[data-is-custom-select]");t.$element[0].reset(),e.parsley().reset();for(var r in t.fields)t.fields.hasOwnProperty(r)&&t.fields[r].$element.removeClass("is-fill");a.length&&$.each(a,function(t,e){$(e).val("").trigger("change")})}},{key:"initDeleteTrigger",value:function(){var t=this;this.$tableWrapper.on("click",".js-delete-trigger",function(e){var a=$(e.currentTarget),r=a.closest("[data-row-id]");if(r.length){var i=r.attr("data-row-id");t.lockTable(),Promise.resolve().delay(100).then(function(){r.remove(),t.deleteRowFromLocalStorage(i),t.updateTableViewStatus(),t.updateSummaryPrice(),t.unlockTable()})}})}},{key:"loadData",value:function(){var t=this;return new Promise(function(e,a){$.ajax({url:t.loadUrl,data:{},dataType:"json",success:function(t){e(t)},error:function(t,e,r){a()}})}).then(function(e){var a=t.getAllRowsFromLocalStorage();return a?Object.assign({},a,e):e})}},{key:"updateTableWithData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[];for(var r in t)if(t.hasOwnProperty(r)&&void 0!==t[r].id&&void 0!==t[r].title){var o=this.markupTemplate.scaffold;for(var n in t[r])if(t[r].hasOwnProperty(n)){var l=t[r][n];if("id"==n&&(o=o.replace(/{{id}}/g,l)),"title"==n&&(o=o.replace(/{{title}}/g,l)),"description"==n&&(o=o.replace(/{{optionalDescription}}/g,this.markupTemplate.optional.description),o=o.replace(/{{description}}/g,l)),"color"==n&&(l?(o=o.replace(/{{optionalColorbox}}/g,this.markupTemplate.optional.colorBox),o=o.replace(/{{colorCode}}/g,l)):o=o.replace(/{{optionalColorbox}}/g,"")),"year"==n&&(o=o.replace(/{{year}}/g,l)),"status"==n){"pednding"==l&&(l="pending");var s=this.getText("status--"+l);o=o.replace(/{{status}}/g,s||"-")}if("price"==n){var c="string"==typeof l?l.replace(/\s/,"").replace(/,/,"."):l,u=i.getPriceWithTax(c,this.tax,2),f=i.formatMoney(c,this.locale),d=i.formatMoney(u,this.locale);o=o.replace(/{{price}}/g,c),o=o.replace(/{{formattedPrice}}/g,f+" "+this.getText("currency")),o=o.replace(/{{priceWithTax}}/g,u),o=o.replace(/{{formattedPriceWithTax}}/g,d+" "+this.getText("currency"))}}o=o.replace(/{{removeButtonText}}/g,this.getText("remove_button_text")),a.push(o)}e?this.$tableRowContainer.append(a.join("")):(this.$tableRowContainer.html(""),this.$tableRowContainer.append(a.join(""))),this.updateSummaryPrice(),this.updateTableViewStatus()}},{key:"updateSummaryPrice",value:function(){var t=0;$.each(this.getRows(),function(e,a){var r=$(a),i=r.find(".js-price-with-tax").length?r.find(".js-price-with-tax").attr("data-original-price-with-tax"):r.find(".js-price").attr("data-original-price");i&&(isNaN(t)||isNaN(i)||(t=Number(t)+Number(i)))}),this.$tableSummaryPrice.html(i.formatMoney(Number(t),this.locale)+" "+this.getText("currency"))}},{key:"getRows",value:function(){return this.$tableRowContainer.find("[data-row-id]")}},{key:"addRowToLocalStorage",value:function(t){t&&t.id&&localStorage&&localStorage.setItem("autoParts--row-"+t.id,JSON.stringify(t))}},{key:"getAllRowsFromLocalStorage",value:function(){var t={};if(!localStorage)return!1;for(var e in localStorage)if(localStorage.hasOwnProperty(e)&&-1!=e.indexOf("autoParts--row")){var a=JSON.parse(localStorage.getItem(e));t[a.id]=a}return!!Object.keys(t).length&&t}},{key:"deleteRowFromLocalStorage",value:function(t){localStorage.getItem("autoParts--row-"+t)&&localStorage.removeItem("autoParts--row-"+t)}},{key:"getTextByLocale",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ru";arguments[1];return function(a){return!!(t.text&&t.text[e]&&t.text[e][a])&&t.text[e][a]}}},{key:"generateUniqRowID",value:function(){var t=0,e=[];if($.each(this.getRows(),function(t,a){e.push($(a).attr("data-row-id"))}),e.length){t=Math.max.apply(null,e.map(Number))+1}return t}},{key:"showTableNotification",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t&&(this.$tableNoty.html(t),this.$tableWrapper.addClass("is-noty"))}},{key:"updateTableViewStatus",value:function(){this.isNoRows()?this.showTableNotification(this.getText("error--empty_data")):this.$tableWrapper.removeClass("is-noty")}},{key:"isNoRows",value:function(){return 0==this.getRows().length}},{key:"lockTable",value:function(){this.$tableWrapper.addClass("is-preloading")}},{key:"unlockTable",value:function(){this.$tableWrapper.removeClass("is-preloading")}},{key:"isTableLock",value:function(){return this.$tableWrapper.hasClass("is-preloading")}}]),t}();t.exports=o}).call(exports,e(1))}},[13]);